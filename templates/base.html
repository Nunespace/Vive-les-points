{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="C65iwhxtGd0Ua7KRoCsM5Ly9umQNrsCrsz7qPTLCozk" />
  <title>{% block title %}Vive les Points | Vive les Points{% endblock title %}</title>

  {% block robots %}<meta name="robots" content="noindex, nofollow">{% endblock %}
  {% if not debug %}
  <link rel="canonical" href="https://vive-les-points.fr{{ request.path }}">
  {% endif %}



  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bungee+Spice&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <link rel="stylesheet" href="{% static 'points/style.css' %}">
  <script src="{% static 'points/js/script.js' %}"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


</head>

<body class="d-flex flex-column min-vh-100">
  <header>
    <div class="container">
      <a class="text-center" href="{% url 'points:dashboard' %}">
        <h1 class="p-1 text-light"
            style="font-family: 'Bungee Spice', sans-serif;"
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
            title="Tableau de bord">
          Vive les Points!
        </h1>
      </a>
    </div>
  </header>

  <main class="flex-grow-1">
    {% if messages %}
      <div class="alerts-stack position-sticky top-0 start-0 end-0" style="z-index:1080;">
        <div class="container pt-2">
          {% for message in messages %}
            <div class="alert alert-{{ message.level_tag }} alert-dismissible fade show shadow-sm mb-3" role="alert">
              {{ message|safe }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% block content %}{% endblock content %}
  </main>

<footer class="bg-warning text-center border mt-auto">
  <div class="container">
    {% if user.is_authenticated %}
    <!-- Version CONNECTÉ : 3 colonnes -->
    <div class="row align-items-center gy-2" style="min-height:60px;">

      <!-- Col gauche : liens parent -->
      <div class="col-12 col-md-4 d-flex flex-column flex-md-row justify-content-center gap-2">
          <a class="btn btn-outline-primary btn-sm" href="{% url 'points:bareme' %}">
            Barèmes
          </a>
        {% if user.profile.role == "parent" %}
          <a class="btn btn-outline-primary btn-sm" href="{% url 'famille:manage_account' %}">
            Mon compte
          </a>
        {% endif %}
      </div>

      <!-- Col gauche : Déconnexion -->
      <div class="col-12 col-md-4 text-start">
        <form method="post" action="{% url 'famille:logout' %}" class="d-inline">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger btn-sm">Se déconnecter</button>
        </form>
      </div>

      <!-- Col droite : copyright + don -->
      <div class="col-12 col-md-4 d-flex justify-content-end align-items-center gap-2">
        <p class="text-dark m-0">
          © 2025 - 
          <a href="mailto:nunespace@gmail.com"
             class="text-dark text-decoration-underline"
             data-bs-toggle="tooltip"
             data-bs-placement="top"
             title="Contact">
            Nunespace
          </a>
        </p>
        <a href="https://paypal.me/nunespace17"
           class="btn btn-primary btn-sm"
           target="_blank" rel="noopener"
           data-bs-toggle="tooltip"
           data-bs-placement="top"
           title="Application gratuite pour les familles – Soutenez le projet"
           aria-label="Faire un don pour soutenir le projet">
          Soutenez le projet
        </a>
      </div>
      
    </div>

    {% else %}
    <!-- Version NON CONNECTÉ : 2 colonnes (remplit l'espace) -->
    <div class="row align-items-center gy-2" style="min-height:60px;">
      <!-- Col gauche : (on n'affiche pas la colonne vide) -->
      <!-- Col centre (devient 6 / 12) : rien de spécial à afficher ici, on peut laisser vide ou mettre un texte -->
      <div class="col-12 col-md-6 d-flex justify-content-center">
        <!-- Laisser vide, ou afficher un message / lien d'aide si tu veux -->
      </div>

      <!-- Col droite : copyright + don -->
      <div class="col-12 col-md-6 d-flex justify-content-end align-items-center gap-2">
        <p class="text-dark m-0">
          © 2025 - 
          <a href="mailto:nunespace@gmail.com"
             class="text-dark text-decoration-underline"
             data-bs-toggle="tooltip"
             data-bs-placement="top"
             title="Contact">
            Nunespace
          </a>
        </p>
        <a href="https://paypal.me/nunespace17"
           class="btn btn-primary btn-sm"
           target="_blank" rel="noopener"
           data-bs-toggle="tooltip"
           data-bs-placement="top"
           title="Application gratuite pour les familles – Soutenez le projet"
           aria-label="Faire un don pour soutenir le projet">
          Soutenez le projet
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</footer>


  <!-- Scripts Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
  <script src="{% static 'points/js/htmx.min.js' %}"></script>

  <!-- Script CSRF pour HTMX -->
  <script>
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }
    document.addEventListener('htmx:configRequest', (event) => {
      const token = getCookie('csrftoken');
      if (token) event.detail.headers['X-CSRFToken'] = token;
    });

    // Active les tooltips Bootstrap
    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    // Gestion des alertes : ferme automatiquement les alerts non dangereuses
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.alert').forEach(function (el) {
        const isDangerOrWarning = el.classList.contains('alert-danger') || el.classList.contains('alert-warning');
        if (!isDangerOrWarning) {
          const inst = bootstrap.Alert.getOrCreateInstance(el);
          setTimeout(() => inst.close(), 4000); // 4s, ajuste si besoin
        }
      });
    });

  </script>

</body>
</html>
